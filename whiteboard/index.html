---
layout: default
---
<script src="https://cdn.firebase.com/js/client/2.2.3/firebase.js"></script>

<div class="post">
  <div class="title"><i class="xtra-muted">my</i><b class="text-muted">whiteboard</b></div>
  <div class="jumbotron pre-scrollable" id="boardBox">
    <p id="whiteboard">

    </p>
  </div>

  <input id="msgTxt" class="form-control" type="text">
  <div class="col-md-12 text-center">
    <button id="msgBtn" class="btn btn-primary btn-lg whiteboard-btn" disabled="true">Write</button>
    <button id="loginBtn" class="btn btn-default btn-lg whiteboard-btn">Login</button>
  </div>

  <div class="muted-content">
    <p>
    Welcome to my whiteboard! Say hello, let me know you stopped by, ask me
    questions, or recommend some content. Whatever you want! I'll be able to
    respond to you directly here.<br><br>

    Not able to see or write to the whiteboard? Firefox and Firebase aren't
    getting along here for some reason - too much fire I guess. If you're using
    the Firefox web browser, try Chrome or IE instead!
    </p>
  </div>

</div>

<script>
  (function() {
    // Relevant page elements
    var jmbo = document.getElementById('boardBox');
    var wboard = document.getElementById('whiteboard');
    var msgTxt = document.getElementById('msgTxt');
    var msgBtn = document.getElementById('msgBtn');
    var loginBtn = document.getElementById('loginBtn');

    // Firebase ref and user init
    var ref = new Firebase('https://dbernardblog.firebaseio.com/whiteboard');
    var usr = null;

    // Add messages to whiteboard
    msgBtn.addEventListener('click', function() {
      // Limit to 140 characters for non-bosses
      if (msgTxt.value.length > 140 && usr.twitter.username !== 'dtbernard') {
        alert("Please limit your messages to a maximum of 140 characters! (Your message was " + msgTxt.value.length + ")");
      }
      // Don't allow empty messages
      else if (msgTxt.value.length < 2) {
        alert("You must enter at least two characters to write on the whiteboard.");
      }
      // Deny any profanities
      else if ($.has_profanity(msgTxt.value)) {
        alert("Woah, watch your language please!");
      }
      else {
        ref.push(usr.twitter.username + ': ' + msgTxt.value);
        msgTxt.value = '';
      }
    });

    // Twitter login
    loginBtn.addEventListener('click', function() {
      ref.authWithOAuthRedirect('twitter', function() {});
    });

    // Listen for authentication
    ref.onAuth(function(authData) {
      if (authData) {
        msgBtn.disabled = false;
        loginBtn.disabled = true;
        usr = authData;
      }
    });

    // Sync data with Firebase
    ref.on('child_added', function(snap) {
      var item = document.createElement('div');

      item.innerText = snap.val();

      // Check and see if this is a message from the boss
      var user = item.innerText.split(':')[0];
      if (user === 'dtbernard') {
        item.className = 'boss';
      }

      wboard.appendChild(item);

      // Set whiteboard to scroll to bottom when loaded
      jmbo.scrollTop = jmbo.scrollHeight;
    });
  }());
</script>
